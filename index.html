<!DOCTYPE HTML>
<html>
	<head>
		<title>Login</title>

		<!--Styling for Login-->
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous"/>
		<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.1/css/all.css" integrity="sha384-gfdkjb5BdAXd+lj+gudLWI+BXq4IuLW5IT+brZEZsLFm++aCMlF1V92rMkPaX4PP" crossorigin="anonymous"/>
		<link type="text/css" rel="stylesheet" href="bootstrap-vue-dev/custom.css" />
		<link href="scss/hover-min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				height: 100%;
				background-image: url("images/app/loginBackground.jpg");
				height: 100%;
			}
			.user_card {
				height: 400px;
				width: 350px;
				margin-top: auto;
				margin-bottom: auto;
				background: lightblue;
				position: relative;
				display: flex;
				justify-content: center;
				flex-direction: column;
				padding: 10px;
				box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2),
					0 6px 20px 0 rgba(0, 0, 0, 0.19);
				-webkit-box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2),
					0 6px 20px 0 rgba(0, 0, 0, 0.19);
				-moz-box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2),
					0 6px 20px 0 rgba(0, 0, 0, 0.19);
				border-radius: 5px;
			}
			.brand_logo_container {
				position: absolute;
				height: 170px;
				width: 170px;
				top: -75px;
				border-radius: 50%;
				background: #60a3bc;
				padding: 10px;
				text-align: center;
			}
			.brand_logo {
				height: 150px;
				width: 150px;
				border-radius: 50%;
				border: 2px solid white;
			}
			.form_container {
				margin-top: 60px;
			}
			.login_btn:focus {
				box-shadow: none !important;
				outline: 0px !important;
			}
			.login_container {
				padding: 0 2rem;
			}
			.input-group-text {
				background: #c0392b !important;
				color: white !important;
				border: 0 !important;
				border-radius: 0.25rem 0 0 0.25rem !important;
			}
			.input_user,
			.input_pass:focus {
				box-shadow: none !important;
				outline: 0px !important;
			}
			#login_text {
				color: white;
				font-size: 40px;
				font-weight: bold;
				display: table;
    			margin: auto;
				margin-bottom: 20px;

			}
		</style>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.6.0/gsap.min.js"></script>
		<meta name="google-signin-client_id" content="999591178620-sgthqg1ea8e8uo0qiuhstkra6ms3783a.apps.googleusercontent.com"/>
		<script	src="https://apis.google.com/js/platform.js" async defer></script>

		<!-- Firebase Source Files-->
		<script src="https://www.gstatic.com/firebasejs/8.3.0/firebase-app.js"></script>
		<script src="https://www.gstatic.com/firebasejs/7.6.1/firebase-database.js"></script>
	</head>
	<body>
		<div class="container h-100">
			<div class="d-flex justify-content-center h-100">
				<div class="user_card animate__animated animate__zoomIn">
					<div class="d-flex justify-content-center">
						<div class="brand_logo_container">
							<img src="images/app/logo.JPG" class="brand_logo hvr-wobble-top" alt="Logo"/>
						</div>
					</div>
					<div class="d-flex justify-content-center form_container">
						<form>
							<div id="login_text">Huddle</div>
							<div class="input-group mb-3">
								<div class="input-group-append">
									<span class="input-group-text"><i class="fas fa-user"></i
									></span>
								</div>
								<input type="text" name="" class="form-control input_user" value="" placeholder="username"/>
							</div>
							<div class="input-group mb-2">
								<div class="input-group-append">
									<span class="input-group-text"><i class="fas fa-key"></i></span>
								</div>
								<input type="password" name="" class="form-control input_pass" value="" placeholder="password"/>
							</div>
							<div class="d-flex justify-content-center mt-3 login_container">
								<button	type="button" name="button" class="btn btn-dark">Login</button>
							</div>
						</form>
					</div>
					<div class="mt-4">
						<div class="d-flex justify-content-center links">
							<div id="signInButton" class="g-signin2" data-onsuccess="onSignIn"></div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<script>
			//Firebase Configuration
			var firebaseConfig = {
				apiKey: "AIzaSyDhBjd0INJO6MpP_SX3vJJFRQzgrc1yCbc",
				authDomain: "just-clover-301402.firebaseapp.com",
				databaseURL:
					"https://just-clover-301402-default-rtdb.firebaseio.com",
				projectId: "just-clover-301402",
				storageBucket: "just-clover-301402.appspot.com",
				messagingSenderId: "999591178620",
				appId: "1:999591178620:web:5ed2ca489e1fee2836b4f9",
				measurementId: "G-4M8XE224JF",
			};

			firebase.initializeApp(firebaseConfig);
			firebase.analytics();

			function onSignIn(googleUser) {
				var profile = googleUser.getBasicProfile();
				console.log("ID: " + profile.getId()); // Do not send to your backend! Use an ID token instead.
				checkUserExists(googleUser);
			}

			function checkUserExists(googleUser) {
				var profile = googleUser.getBasicProfile();
				var userID = profile.getId();
				var user = firebase.database().ref("users/" + userID);
				user.once("value").then((snapshot) => {
					if (snapshot.exists()) {
						location.replace("listings.html");
						sessionStorage.setItem("userId", userID);
					} else {
						registerUser(googleUser);
					}
				});
			}

			function registerUser(googleUser) {
				var profile = googleUser.getBasicProfile();
				var userID = profile.getId();
				var userEmail = profile.getEmail();
				var userFullName = profile.getName();
				firebase.database().ref('users/' + userID).set({
					email: userEmail,
					name: userFullName,
					role: "customer"
				}, function (error) {
					if (error) {
						alert("Unable to Login using Google!");
					} else {
						alert("Welcome to Huddles, " + userFullName);
						sessionStorage.setItem("userId", userID);
						location.replace("listings.html");
					}
				});
			}
		</script>
	</body>
</html>
